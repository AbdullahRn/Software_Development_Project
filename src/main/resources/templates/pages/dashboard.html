<div xmlns:th="http://www.thymeleaf.org" th:fragment="content">

    <div class="message" th:if="${message}" th:text="${message}"></div>

    <div class="dashboard-page">

        <div class="button-group">
            <button type="button" onclick="changeChartData('count')">Total No Of Transactions</button>
            <button type="button" onclick="changeChartData('quantity')">Product Quantity</button>
            <button type="button" onclick="changeChartData('amount')">Amount</button>
        </div>

        <div class="dashboard-content">

            <div class="filter-section">
                <label for="month-select">Select Month:</label>
                <select id="month-select" onchange="reloadChart()">
                    <option value="1">January</option>
                    <option value="2">February</option>
                    <option value="3">March</option>
                    <option value="4">April</option>
                    <option value="5">May</option>
                    <option value="6">June</option>
                    <option value="7">July</option>
                    <option value="8">August</option>
                    <option value="9">September</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>
                </select>

                <label for="year-select">Select Year:</label>
                <select id="year-select" onchange="reloadChart()">
                    <option th:each="y : ${#numbers.sequence(2022, 2030)}"
                            th:value="${y}"
                            th:text="${y}">
                    </option>
                </select>
            </div>

            <div class="chart-section">
                <div class="chart-container">
                    <h3>Daily Transactions</h3>
                    <canvas id="transactionChart" height="120"></canvas>

                    <div class="ai-card">
                        <h3>AI Restock Suggestions</h3>
                        <ul id="restockList"></ul>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script th:inline="javascript">
        let transactionData = [[${transactionData}]];
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        let selectedKey = "amount";
        let chart;

        function buildChart(key) {
            selectedKey = key;

            const labels = transactionData.map(item => item.day);
            const values = transactionData.map(item => item[key]);

            const ctx = document.getElementById('transactionChart').getContext('2d');

            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: key.toUpperCase(),
                        data: values,
                        borderWidth: 2,
                        fill: false
                    }]
                }
            });
        }

        function changeChartData(key) {
            buildChart(key);
        }

        function reloadChart() {
            buildChart(selectedKey);
        }

        buildChart("amount");
    </script>

    <script src="/js/dashboard-ai.js"></script>

</div>
